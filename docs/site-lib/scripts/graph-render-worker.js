if("function"==typeof importScripts){importScripts("https://d157l7jdn8e5sf.cloudfront.net/v7.2.0/webworker.js","./tinycolor.js"),addEventListener("message",onMessage),self.WebGLRenderingContext=self.WebGL2RenderingContext||self.WebGLRenderingContext;let e=null,t=null,n=null;isDrawing=!1;let o=0,a=[],r=[],i=0,l=[],c=[],d=[],s=[],u=[],g={x:0,y:0},p=new Float32Array(0),f=0,h=0,y={background:2302755,link:11184810,node:13421772,outline:11184810,text:16777215,accent:4203434},S=-1,x=-1,m=-1,v=!1,b=[],w=-1,C=1,k=1;function toScreenSpace(e,t,n=!0){return n?{x:Math.floor(e*C+g.x),y:Math.floor(t*C+g.y)}:{x:e*C+g.x,y:t*C+g.y}}function vecToScreenSpace({x:e,y:t},n=!0){return toScreenSpace(e,t,n)}function toWorldspace(e,t){return{x:(e-g.x)/C,y:(t-g.y)/C}}function vecToWorldspace({x:e,y:t}){return toWorldspace(e,t)}function setCameraCenterWorldspace({x:e,y:t}){g.x=canvas.width/2-e*C,g.y=canvas.height/2-t*C}function getCameraCenterWorldspace(){return toWorldspace(canvas.width/2,canvas.height/2)}function getNodeScreenRadius(e){return e*k}function getNodeWorldspaceRadius(e){return e/k}function getPosition(e){return{x:p[2*e],y:p[2*e+1]}}function mixColors(e,t,n){return tinycolor.mix(tinycolor(e.toString(16)),tinycolor(t.toString(16)),n).toHexNumber()}function darkenColor(e,t){return tinycolor(e.toString(16)).darken(t).toHexNumber()}function lightenColor(e,t){return tinycolor(e.toString(16)).lighten(t).toHexNumber()}function invertColor(e,t){for(e=e.toString(16);e.length<6;)e="0"+e;if(0===e.indexOf("#")&&(e=e.slice(1)),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6!==e.length)throw new Error("Invalid HEX color:"+e);var n=parseInt(e.slice(0,2),16),o=parseInt(e.slice(2,4),16),a=parseInt(e.slice(4,6),16);return t?.299*n+.587*o+.114*a>186?"#000000":"#FFFFFF":(n=(255-n).toString(16),o=(255-o).toString(16),a=(255-a).toString(16),"#"+padZero(n)+padZero(o)+padZero(a))}function clamp(e,t,n){return Math.min(Math.max(e,t),n)}function lerp(e,t,n){return e+(t-e)*n}let M=0,N=.04,T=0,F=.08,P=15,I=12,L=P/I;function showLabel(e,t,n=0){let o=u[e];if(!o)return;if(d[e]=t,!(t>.01))return void hideLabel(e);o.visible=!0,o.style.fontSize=lerp(I,P,n);let a=vecToScreenSpace(getPosition(e)),r=s[e]*lerp(1,L,n)/2;o.x=a.x-r,o.y=a.y+getNodeScreenRadius(l[e])+9,o.alpha=t}function hideLabel(e){u[e].visible=!1}function draw(){n.clear();let e=[];v&&(b=[]),-1!=S||-1!=m?(M=Math.min(1,M+N),T=Math.min(1,T+F)):(M=Math.max(0,M-N),T=Math.max(0,T-F)),n.lineStyle(1,mixColors(y.link,y.background,50*M),.7);for(let t=0;t<o;t++){let o=r[t],i=a[t];S!=i&&S!=o&&(x!=i&&x!=o||0==M)||(v&&S==i?b.push(o):v&&S==o&&b.push(i),e.push(t));let c=getPosition(i),d=getPosition(o),s=vecToScreenSpace(c),u=vecToScreenSpace(d);Math.sqrt(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2))<(l[i]+l[o])*h&&(n.moveTo(s.x,s.y),n.lineTo(u.x,u.y))}let t=1-.5*M;n.beginFill(mixColors(y.node,y.background,50*M),t),n.lineStyle(0,16777215);for(let e=0;e<i;e++){let t=getNodeScreenRadius(l[e]);if(S!=e)if(t>2){showLabel(e,lerp(0,(t-4)/8-1/k/6*.9,Math.max(1-M,.2)))}else hideLabel(e);if(S==e||x==e&&0!=M||-1!=S&&b.includes(e))continue;let o=vecToScreenSpace(getPosition(e));n.drawCircle(o.x,o.y,t)}n.endFill(),t=.7*M,n.lineStyle(1,mixColors(mixColors(y.link,y.accent,100*M),y.background,20),t);for(let t=0;t<e.length;t++){let o=r[e[t]],i=vecToScreenSpace(getPosition(a[e[t]])),l=vecToScreenSpace(getPosition(o));n.moveTo(i.x,i.y),n.lineTo(l.x,l.y)}if(-1!=S||-1!=x&&0!=M){n.beginFill(mixColors(y.node,y.accent,20*M),.9),n.lineStyle(0,16777215);for(let e=0;e<b.length;e++){let t=b[e],o=vecToScreenSpace(getPosition(t));n.drawCircle(o.x,o.y,getNodeScreenRadius(l[t])),showLabel(t,Math.max(.6*M,d[t]))}n.endFill();let e=-1!=S?S:x,t=vecToScreenSpace(getPosition(e));n.beginFill(mixColors(y.node,y.accent,100*M),1),n.lineStyle(M,mixColors(invertColor(y.background,!0),y.accent,50)),n.drawCircle(t.x,t.y,getNodeScreenRadius(l[e])),n.endFill(),showLabel(e,Math.max(M,d[e]),T)}if(v=!1,n.lineStyle(2,y.accent),-1!=w){let e=vecToScreenSpace(getPosition(w));n.drawCircle(e.x,e.y,getNodeScreenRadius(l[w])+4)}}function onMessage(b){if("draw"==b.data.type)p=new Float32Array(b.data.positions),draw();else if("update_camera"==b.data.type)g=b.data.cameraOffset,C=b.data.cameraScale,k=Math.sqrt(C);else if("update_interaction"==b.data.type)S!=b.data.hoveredNode&&-1!=b.data.hoveredNode&&(v=!0),m!=b.data.grabbedNode&&-1!=b.data.hoveredNode&&(v=!0),x=-1==b.data.hoveredNode?S:-1,S=b.data.hoveredNode,m=b.data.grabbedNode;else if("resize"==b.data.type)e.renderer.resize(b.data.width,b.data.height);else if("set_active"==b.data.type)w=b.data.active;else if("update_colors"==b.data.type){y=b.data.colors;for(let e of u)e.style.fill=invertColor(y.background,!0)}else if("init"==b.data.type){o=b.data.linkCount,a=b.data.linkSources,r=b.data.linkTargets,i=b.data.nodeCount,l=b.data.radii,c=b.data.labels,f=b.data.linkLength,h=b.data.edgePruning,p=new Float32Array(i),e||(e=new PIXI.Application({...b.data.options,antialias:!0,resolution:2,backgroundAlpha:0,transparent:!0}),t=new PIXI.Container,n=new PIXI.Graphics,e.stage.addChild(t),t.addChild(n));for(let e of u)e.destroy();u=[],s=[],d=[];for(let t=0;t<i;t++){let n=new PIXI.Text(c[t],{fontFamily:"Arial",fontSize:12,fontWeight:"normal",fill:invertColor(y.background,!0),align:"center",anchor:.5});u.push(n),s.push(n.width),d.push(0),e.stage.addChild(n)}}else console.log("Unknown message type sent to graph worker: "+b.data.type)}}